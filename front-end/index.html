<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.0/Chart.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"
            integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
            crossorigin="anonymous"></script>
    <!-- <script src="stuff.js"></script> -->
    <title>The Drought: Cape Town's Water Crisis</title>
    <meta name="description" content="Monitoring, information, and data about South Africa's worst drought in history.">
    <meta name="keywords" content="cape town, cape town drought, water crisis, save water, dam levels, cape town dam levels">
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@capetowndrought" />
    <meta name="twitter:creator" content="@czue" />
    <meta property="og:title" content="The Drought: Cape Town's Water Crisis" />
    <meta property="og:description" content="Monitoring, information, and data about South Africa's worst drought in history.">
    <meta property="og:type" content="website" />
    <meta property="og:url" content="http://www.capetowndrought.com/" />
    <meta property="og:image" content="/images/cape-town-drought.png" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.6.0/css/bulma.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-94102737-8"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-94102737-8');
    </script>
</head>
<body>
    <section class="hero is-warning is-bold ">
      <div class="hero-body">
        <div class="container">
          <h1 class="title">Cape Town's Water Crisis</h1>
          <h2 class="subtitle">Monitoring, information, and data about South Africa's worst drought in history</h2>
        </div>
      </div>
    </section>
    <section class="section">
        <div class="container">
         <nav class="level">
          <div class="level-item has-text-centered">
            <div>
              <p class="title is-size-1"><span class="days-left"></span> Days</p>
              <p class="heading is-size-6">Time until Taps Turn Off</p>
            </div>
          </div>
          <div class="level-item has-text-centered">
            <div>
              <p class="title is-size-1 dam-levels"></p>
              <p class="heading is-size-6">Current Dam Levels</p>
            </div>
          </div>
        </nav>
        <hr>
        <nav class="level">
          <div class="level-item has-text-centered">
            <div>
              <p class="title is-size-2">50L</p>
              <p class="heading is-size-6">Recommended daily usage</p>
            </div>
          </div>
          <div class="level-item has-text-centered">
            <div>
              <p class="title is-size-2 people-saving"></p>
              <p class="heading is-size-6">Capetonians Saving Properly</p>
            </div>
          </div>
          <div class="level-item has-text-centered">
            <div>
              <p class="title is-size-2 over-consumption"></p>
              <p class="heading is-size-6">Over-consumption</p>
            </div>
          </div>
        </nav>
        <p class="small has-text-grey-light has-text-centered">
            Data courtesy of <a href="http://coct.co/water-dashboard/" class="has-text-grey-light" style="text-decoration: underline;">City of Cape Town</a>.
            Last updated <span class="last-updated"></span>
        </p>
        <div class="content">
            <h2>Background Information</h2>
            <p>
                The City of Cape Town is experiencing its worst drought in over a century and if nothing is done
                the city is likely to run out of water before the rainy season of 2018.
                This plot of Cape Town's supply over the last five years aims to make that obvious to everyone.
                <strong>If historical usage trends continue, there is not enough water to get Cape Town through the summer.</strong>
                Despite this major crisis, many people in the city are not changing their behavior fast enough.
            </p>
            <p>
                Please help us save water!
            </p>
            <h2>Historical Dam Levels for the Cape Town Region: 2012&mdash;Present</h2>
            <p>
                The easiest way to see trends and how bad the situation is today is by looking at this graph of the dam levels over time.
                This makes it clear both how severe the situation is and how scary the current drop-off is.
                The red line represents the estimated point at which the taps will be turned off, a.k.a. "Day Zero".
            </p>
            <canvas id="myChart" width="800" height="600"></canvas>
            <p class="has-text-centered has-text-grey"><small>Last Updated: <span class="last-updated"></span></small></p>
        </div>
    </section>
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-half">
                    <h2 class="title">Water Saving Tips</h2>
                    <p class="subtitle">
                        Here are four simple things that everyone in Cape Town can do today to respond to this crisis.
                    </p>
                    <div class="tile is-ancestor">
                        <div class="tile is-vertical">
                            <div class="tile">
                                <div class="tile is-parent">
                                    <div class="tile is-child box">
                                        <p class="title">Short Showers</p>
                                        <p>Save <strong>10 L</strong> of water for every minute shaved off your shower. The city recommends taking 90-second showers.</p>
                                    </div>
                                </div>
                                <div class="tile is-parent">
                                    <div class="tile is-child box">
                                        <p class="title">Fewer Flushes</p>
                                        <p>Save <strong>9 L</strong> of water every time you choose not to flush your toilet. If it's yellow, let it mellow!</p>
                                    </div>
                                </div>
                            </div>
                            <div class="tile">
                                <div class="tile is-parent">
                                    <div class="tile is-child box">
                                        <p class="title">Smarter Flushes</p>
                                        <p>Save <strong>8 L</strong> of water every day by dropping a brick or full bottle into your toilet cistern to reduce its water consumption.</p>
                                    </div>
                                </div>
                                <div class="tile is-parent">
                                    <div class="tile is-child box">
                                        <p class="title">Use Greywater</p>
                                        <p>Put a bucket in your shower and sink, and use the run-off to flush toilets.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="content">
                        <p>For more information and ideas, check out the Resources below.</p>
                    </div>
                    <h2 class="title">Recommended Resources</h2>

                        <ul>
                            <li><a href="http://coct.co/water-dashboard/">City of Cape Town Water Dashboard</a></li>
                            <li><a href="http://mycapetownneeds.co.za/thinkwater/">Think Water Calculator</a></li>
                            <li><a href="https://defeatdayzero.co.za/">#DefeatDayZero</a></li>
                            <li><a href="https://citymaps.capetown.gov.za/waterviewer/">City Water Usage Map</a></li>
                            <li><a href="https://www.news.uct.ac.za/article/-2017-08-31-how-severe-is-the-droughta">How Severe is the Drought? (UCT)</a></li>
                            <li><a href="https://en.wikipedia.org/wiki/2015-present_Cape_Town_drought">The Drought on Wikipedia</a></li>
                            <li><a href="https://www.westerncape.gov.za/general-publication/saving-water-your-home">Saving Water In Your Home (Western Cape Government)</a></li>
                        </ul>

                </div>
                <div class="column is-half">
                    <div class="has-text-centered">
                        <figure class="image">
                            <img src="/images/50l.png">
                            <figcaption class="has-text-grey-light">Infographic courtesy of <a class="has-text-grey-light " href="http://ewn.co.za/" style="text-decoration: underline;">Eyewitness News</a></figcaption>
                        </figure>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <footer class="footer">
      <div class="container">
        <div class="content has-text-centered">
          <p>
            Made by <a href="http://www.coryzue.com">Cory Zue</a> and <a href="https://github.com/nathanbegbie">Nathan Begbie</a> |
            <a href="https://github.com/czue/capetown-drought">Source</a> on <i class="fa fa-github"></i> |
            Data from <a href="http://web1.capetown.gov.za/web1/opendataportal/">City of Cape Town</a>
          </p>
          <p>
            No <span class="icon has-text-info"><i class="fa fa-tint"></i></span> was wasted in the creation of this site.
          </p>
        </div>
      </div>
    </footer>
    <script>
    function getLegend(width) {
        if (width < 600)
        {
            return {
                display: false
            };
        } else if (width < 1000) {
            return {
                display: true,
                position: "bottom"
            }
        } else {
            return {
                display: true,
                position: "right"
            }
        }
    }
    var COLORS = [
        "rgba(156, 204, 60, 0.2)",
        "rgba(22, 169, 143, 0.2)",
        "rgba(26, 146, 206, 0.2)",
        "rgba(11, 87, 165, 0.2",
        "rgba(107, 69, 156, 0.2)",
        "rgba(164, 69, 153, 0.2)",
        "rgba(228, 66, 152, 0.2)",
        "rgba(236, 32, 41, 0.2)",
        "rgba(248, 144, 33, 0.2)",
        "rgba(255, 193, 20, 0.2)",
        "rgba(247, 238, 35, 0.2)",
    ];

    function getColor(index) {
        if (index < COLORS.length) {
            return COLORS[index];
        }
        return COLORS[10];  // default
    }

    $(function () {
        var ctx = document.getElementById("myChart");
        var cutoff = 112500;
        var today = new Date();
        var dayZero = new Date(2018, 3, 12);
        var damLevels = '27.2%';
        var peopleSaving = '41%';
        var overConsumption = '19.6%';
        // https://stackoverflow.com/a/2627493/8207
        var oneDay = 24*60*60*1000; // hours*minutes*seconds*milliseconds
        var daysLeft = Math.round(Math.abs((today.getTime() - dayZero.getTime())/(oneDay)));
        $('.days-left').text(daysLeft);
        $('.dam-levels').text(damLevels);
        $('.people-saving').text(peopleSaving);
        $('.over-consumption').text(overConsumption);
        // dynamic legend for different browser widths
        $.getJSON('main-data.json', function(data) {
            $('.last-updated').text(data.metadata.updated);
            var chartData = data.chart_data;
            for (var i = 0; i < chartData.datasets.length; i++) {
                chartData.datasets[i]['backgroundColor'] = getColor(i);
                chartData.datasets[i]['yAxisID'] = 'dams';
            }
            var lineData = [];
            for (var i = 0; i < chartData.labels.length; i++) {
                lineData.push(cutoff);
            }
            var lineData = {
                "label": "Estimated Cutoff Level",
                "data": lineData,
                "borderColor": "#f00",
                "backgroundColor": "#fff",
                "fill": false,
                "yAxisID": "secondary",
            }
            chartData.datasets.push(lineData);
            var max = 1000000;
            var min = 0;
            var myChart = new Chart(ctx, {
                type: 'line',
                data: chartData,
                options: {
                    scales: {
                        yAxes: [
                            {
                                id: "dams",
                                stacked: true,
                                ticks: {
                                    max: max,
                                    min: min,
                                    callback: function(value, index, values) {
                                        return value + " Ml";
                                    }
                                }
                            },
                            {
                                id: "secondary",
                                display: false,
                                stacked: false,
                                ticks: {
                                    max: max,
                                    min: min,
                                }
                            },
                        ],
                    },
                    elements: {
                        point: {
                            radius: 0
                        }
                    },
                    layout: {
                        padding: 20,
                    },
                    legend: getLegend(document.body.clientWidth),
                    maintainAspectRatio: true
                }
            });
        });

        // hide legend on small devices
        // https://github.com/chartjs/Chart.js/issues/1933#issuecomment-174544514
        // this is wonky so don't bother for now.
        //    var resizeId;
        //    window.onresize = function(event) {
        //        clearTimeout(resizeId);
        //        resizeId = setTimeout(afterResizing, 100);
        //    };
        //    function afterResizing(){
        //        myChart.options.legend = getLegend(document.getElementById("myChart").clientWidth);
        //        myChart.update();
        //    }

    });
    </script>
</body>
</html>
