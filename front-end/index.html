<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.0/Chart.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"
            integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
            crossorigin="anonymous"></script>
    <!-- <script src="stuff.js"></script> -->
    <title>The Drought: Cape Town's Water Crisis</title>
    <meta name="description" content="Monitoring, information, and data about South Africa's worst drought in history.">
    <meta name="keywords" content="cape town, cape town drought, water crisis, save water, dam levels, cape town dam levels">
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@capetowndrought" />
    <meta name="twitter:creator" content="@czue" />
    <meta property="og:title" content="The Drought: Cape Town's Water Crisis" />
    <meta property="og:description" content="Monitoring, information, and data about South Africa's worst drought in history.">
    <meta property="og:type" content="website" />
    <meta property="og:url" content="http://www.capetowndrought.com/" />
    <meta property="og:image" content="/images/cape-town-drought.png" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.6.0/css/bulma.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-94102737-8"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-94102737-8');
    </script>
</head>
<body>
    <section class="hero is-warning is-bold ">
      <div class="hero-body">
        <div class="container">
          <h1 class="title">Cape Town's Water Crisis</h1>
          <h2 class="subtitle">Monitoring, information, and data about South Africa's worst drought in history</h2>
        </div>
      </div>
    </section>
    <section class="section">
        <div class="container">
         <nav class="level">
          <div class="level-item has-text-centered">
            <div>
              <p class="title is-size-1 dam-levels"></p>
              <p class="heading is-size-6">Current Dam Levels</p>
            </div>
          </div>
          <!--<div class="level-item has-text-centered">-->
            <!--<div>-->
              <!--<p class="title is-size-1 usable-levels"></p>-->
              <!--<p class="heading is-size-6">Usable Dam Levels</p>-->
            <!--</div>-->
          <!--</div>-->
          <!--<div class="level-item has-text-centered">-->
            <!--<div>-->
              <!--<p class="title is-size-2">?</p>-->
              <!--<p class="heading is-size-6">Recommended daily usage</p>-->
            <!--</div>-->
          <!--</div>-->
        </nav>
        <p class="small has-text-grey-light has-text-centered">
            Data courtesy of <a href="http://coct.co/water-dashboard/" class="has-text-grey-light" style="text-decoration: underline;">City of Cape Town</a>.
            Last updated <span class="last-updated"></span>
        </p>
        <div class="content">
            <h2>Background Information</h2>
            <p>
                In 2018, the City of Cape Town experienced its worst drought in over a century.
                This site was created to make that obvious to everyone.
            </p>
            <p>
                Thankfully, in 2018 the region had a relatively bountiful rainy season,
                and the city was able to escape it's "Day Zero" plans for turning off
                the city's water supply.
            </p>
            <p>
                Still, <em>the region is stressed</em>.
                Ultimately, it relies on a limited water supply that is highly subject to seasonal influence.
                Meanwhile, the population and water consumption continue to grow.
            </p>
            <h2>Historical Dam Levels for the Cape Town Region: 2012&mdash;Present</h2>
            <p>
                The easiest way to see trends and how bad the situation is today is by looking at this graph of the dam levels over time.
                This makes it clear both how severe the situation is and how scary the current drop-off is.
                The red line represents the estimated point at which the taps will be turned off, a.k.a. "Day Zero".
            </p>
            <div class="field is-horizontal">
                <div class="field-label is-normal">
                    <label for="history" class="label">Show data for: </label>
                </div>
                <div class="field-body">
                    <div class="select">
                        <select id="history">
                            <option value="1">1 year</option>
                            <option value="2">2 years</option>
                            <option value="3" selected="selected">3 years</option>
                            <option value="4">4 years</option>
                            <option value="5">5 years</option>
                            <option value="all">All Time</option>
                        </select>
                    </div>
                </div>
            </div>
            <canvas id="myChart" width="800" height="600"></canvas>
            <p class="has-text-centered has-text-grey"><small>Last Updated: <span class="last-updated"></span></small></p>
        </div>
    </section>
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-half">
                    <h2 class="title">Water Saving Tips</h2>
                    <p class="subtitle">
                        Here are four simple things that everyone in Cape Town can do today to respond to this crisis.
                    </p>
                    <div class="tile is-ancestor">
                        <div class="tile is-vertical">
                            <div class="tile">
                                <div class="tile is-parent">
                                    <div class="tile is-child box">
                                        <p class="title">Short Showers</p>
                                        <p>Save <strong>10 L</strong> of water for every minute shaved off your shower. The city recommends taking 90-second showers.</p>
                                    </div>
                                </div>
                                <div class="tile is-parent">
                                    <div class="tile is-child box">
                                        <p class="title">Fewer Flushes</p>
                                        <p>Save <strong>9 L</strong> of water every time you choose not to flush your toilet. If it's yellow, let it mellow!</p>
                                    </div>
                                </div>
                            </div>
                            <div class="tile">
                                <div class="tile is-parent">
                                    <div class="tile is-child box">
                                        <p class="title">Smarter Flushes</p>
                                        <p>Save <strong>8 L</strong> of water every day by dropping a brick or full bottle into your toilet cistern to reduce its water consumption.</p>
                                    </div>
                                </div>
                                <div class="tile is-parent">
                                    <div class="tile is-child box">
                                        <p class="title">Use Greywater</p>
                                        <p>Put a bucket in your shower and sink, and use the run-off to flush toilets.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="content">
                        <p>For more information and ideas, check out the Resources below.</p>
                    </div>
                    <h2 class="title">Recommended Resources</h2>

                        <ul>
                            <li><a href="http://coct.co/water-dashboard/">City of Cape Town Water Dashboard</a></li>
                            <li><a href="http://mycapetownneeds.co.za/thinkwater/">Think Water Calculator</a></li>
                            <li><a href="https://defeatdayzero.co.za/">#DefeatDayZero</a></li>
                            <li><a href="https://citymaps.capetown.gov.za/waterviewer/">City Water Usage Map</a></li>
                            <li><a href="https://www.news.uct.ac.za/article/-2017-08-31-how-severe-is-the-droughta">How Severe is the Drought? (UCT)</a></li>
                            <li><a href="https://en.wikipedia.org/wiki/2015-present_Cape_Town_drought">The Drought on Wikipedia</a></li>
                            <li><a href="https://www.westerncape.gov.za/general-publication/saving-water-your-home">Saving Water In Your Home (Western Cape Government)</a></li>
                        </ul>

                </div>
                <div class="column is-half">
                    <div class="has-text-centered">
                        <figure class="image">
                            <img src="/images/50l.png">
                            <figcaption class="has-text-grey-light">Infographic courtesy of <a class="has-text-grey-light " href="http://ewn.co.za/" style="text-decoration: underline;">Eyewitness News</a></figcaption>
                        </figure>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <footer class="footer">
      <div class="container">
        <div class="content has-text-centered">
          <p>
            Made by <a href="http://www.coryzue.com">Cory Zue</a> and <a href="https://github.com/nathanbegbie">Nathan Begbie</a> |
            <a href="https://github.com/czue/capetown-drought">Source</a> on <i class="fa fa-github"></i> |
            Data from <a href="http://web1.capetown.gov.za/web1/opendataportal/">City of Cape Town</a>
          </p>
          <p>
            No <span class="icon has-text-info"><i class="fa fa-tint"></i></span> was wasted in the creation of this site.
          </p>
        </div>
      </div>
    </footer>
    <script>
    function getLegend(width) {
        if (width < 600)
        {
            return {
                display: false
            };
        } else if (width < 1000) {
            return {
                display: true,
                position: "bottom"
            }
        } else {
            return {
                display: true,
                position: "right"
            }
        }
    }
    var COLORS = [
        "rgba(156, 204, 60, 0.2)",
        "rgba(22, 169, 143, 0.2)",
        "rgba(26, 146, 206, 0.2)",
        "rgba(11, 87, 165, 0.2",
        "rgba(107, 69, 156, 0.2)",
        "rgba(164, 69, 153, 0.2)",
        "rgba(228, 66, 152, 0.2)",
        "rgba(236, 32, 41, 0.2)",
        "rgba(248, 144, 33, 0.2)",
        "rgba(255, 193, 20, 0.2)",
        "rgba(247, 238, 35, 0.2)",
    ];

    function getColor(index) {
        if (index < COLORS.length) {
            return COLORS[index];
        }
        return COLORS[10];  // default
    }

    $(function () {
        var ctx = document.getElementById("myChart");
        var cutoff = 112500;
        var damLevels = '84.1%';
        // var usableLevels = '70.6%';
        // https://stackoverflow.com/a/2627493/8207
        var latestDate = new Date();
        var allChartData, lineData, chartObject;
        $('.dam-levels').text(damLevels);
        // $('.usable-levels').text(usableLevels);
        // dynamic legend for different browser widths
        function getStartDate() {
            var history = $('#history').val();
            if (history === 'all') {
                return null;
            } else {
                var copiedDate = new Date(latestDate.getTime());
                copiedDate.setFullYear(copiedDate.getFullYear() - history);
                return copiedDate.toJSON().slice(0,10);
            }
        }
        function getFilteredChartData() {
            var startFrom = getStartDate();
            var filteredData = jQuery.extend(true, {}, allChartData);
            var filteredLineData = lineData.slice();
            if (startFrom !== null) {
                var startIndex = filteredData.labels.indexOf(startFrom);
                filteredData.labels = filteredData.labels.slice(startIndex)
                for (var i = 0; i < filteredData.datasets.length; i++) {
                    filteredData.datasets[i].data = filteredData.datasets[i].data.slice(startIndex);
                }
                filteredLineData = filteredLineData.slice(startIndex);
            }
            return [filteredData, filteredLineData];
        }
        function updateChart(dataSets) {
            var chartData = dataSets[0];
            var lineDataSet = dataSets[1];
            var lineData = {
                "label": "Estimated Cutoff Level",
                "data": lineDataSet,
                "borderColor": "#f00",
                "backgroundColor": "#fff",
                "fill": false,
                "yAxisID": "secondary",
            };
            chartData.datasets.push(lineData);
            var max = 1000000;
            var min = 0;
            if (chartObject === undefined) {
                chartObject = new Chart(ctx, {
                    type: 'line',
                    data: chartData,
                    options: {
                        scales: {
                            yAxes: [
                                {
                                    id: "dams",
                                    stacked: true,
                                    ticks: {
                                        max: max,
                                        min: min,
                                        callback: function(value, index, values) {
                                            return value + " Ml";
                                        }
                                    }
                                },
                                {
                                    id: "secondary",
                                    display: false,
                                    stacked: false,
                                    ticks: {
                                        max: max,
                                        min: min,
                                    }
                                },
                            ],
                        },
                        elements: {
                            point: {
                                radius: 0
                            }
                        },
                        layout: {
                            padding: 20,
                        },
                        legend: getLegend(document.body.clientWidth),
                        maintainAspectRatio: true
                    }
                });
            } else {
                chartObject.config.data = chartData;
                chartObject.update();
            }
        }
        $.getJSON('main-data.json', function(data) {
            $('.last-updated').text(data.metadata.updated);
            allChartData = data.chart_data;
            latestDate = new Date(allChartData.labels[allChartData.labels.length - 1]);
            for (var i = 0; i < allChartData.datasets.length; i++) {
                allChartData.datasets[i]['backgroundColor'] = getColor(i);
                allChartData.datasets[i]['yAxisID'] = 'dams';
            }
            lineData = [];
            for (var i = 0; i < allChartData.labels.length; i++) {
                lineData.push(cutoff);
            }
            var dataSets = getFilteredChartData();
            updateChart(dataSets);
        });
        $('#history').change(function (e) {
            var dataSets = getFilteredChartData();
            updateChart(dataSets);
        });
    });
    </script>
</body>
</html>
